# xiao 75% keyboard について

xiao 75% keyboard は、下記の特徴を持つ、75%キーボードです。
* 16mm×16mmの狭ピッチ。
* Kailh PG1232 Mini Choc または Kailh PG1350 Choc (V1) に対応。
* アナログスティックによるマウス機能搭載、マウスボタンには Kailh X Switch を採用。
* コントローラーに Seeed XIAO を採用。
* USBケーブルを出す方向を、右と左を選択可能。
* キースイッチ用にバックライトを取り付け可能。

![キーボード写真 1](resources/xiao-75-keyboard.jpg)
![キーボード写真 2](resources/xiao-75-keyboard-led.jpg)

xiao 75% keyboard のレイアウトは、このようになっています。  
![レイアウト](resources/layout.png)  
1.25u のキーキャップを使うキーを、暗い色で示しています。

私は `CapsLock` キーを使用せず、 `左Control` にしています。

# 組み立てに必要なパーツ

## キーボード本体

* 86x [Kailh PG1232 mini choc switch](https://www.aliexpress.com/item/4000277394324.html) または [Kailh PG1530 choc switch](https://shop.yushakobo.jp/products/pg1350)
  * キーボードスイッチ用
* 2x [Kailh PG1425 X switch](https://shop.dailycraft.jp/products/x_switch)
  * マウスボタン用
* 1x [TOP-UP JT8P-3.2T-B10K-1-16Y](https://akizukidenshi.com/catalog/g/gP-04048)
  * ポインティングデバイス
* 1x [Seeed XIAO](https://akizukidenshi.com/catalog/g/gM-15178)
  * Seeed XIAO
  * ピンヘッダが実装されていない物を使用します。
* 88x [1N4148W](https://akizukidenshi.com/catalog/g/gI-07084)
  * SOD-123 表面実装 スイッチングダイオード
* 4x [SS2040FL](https://akizukidenshi.com/catalog/g/gI-02073)
  * SOD-123 表面実装 低 Vf ダイオード
* 10x [表面実装抵抗 560Ω 1608サイズ](https://www.sengoku.co.jp/mod/sgk_cart/detail.php?code=EEHD-57GE)
* 10x [1SS355VM](https://akizukidenshi.com/catalog/g/gI-05866)
  * SOD-323 表面実装 スイッチングダイオード
* 2x [7P 丸ピンICソケット](https://akizukidenshi.com/catalog/g/gP-01014)
  * USBケーブルを出す方向を、左右切り替えたい場合、4個。
  * 丸ピンICソケットは切断しづらいので、切断済みをおすすめします。
* 1x [14P 細ピンヘッダ](https://akizukidenshi.com/catalog/g/gC-04397)
  * 真ん中で切断し、 7P 2個にします。
* 1x [キーボード基板](circuit/xiao-75-keyboard.zip)
  * [circuit/xiao-75-keyboard.zip](circuit/xiao-75-keyboard.zip) を、 [Elecrow](https://www.elecrow.com/pcb-manufacturing.html) などに発注することで入手できます。
* 1x キーキャップ1セット
  * Kailh Choc 用 16x16 ピッチ用 1u 77個
  * Kailh Choc 用 16x16 ピッチ用 1.25u 9個
  * アナログスティック用キャップ 1個
  * Kailh X Switch用キーキャップ 2個

## バックライトLED(オプション)

本キーボードのバックライトLEDは、マイコンとは独立したスイッチにより、点灯/消灯する仕様となっています。  
マイコンによるLED制御には対応していません。

バックライトLEDを使用する場合、下記の部品が必要となります。
* 86x [表面実装LED 2012サイズ](https://akizukidenshi.com/catalog/g/gI-06422)
  * 未検証ですが、もしかすると、1608サイズの方がよいかもしれません。
* 86x [表面実装抵抗 2.2kΩ 2012サイズ](https://www.sengoku.co.jp/mod/sgk_cart/detail.php?code=EEHD-57C4)
  * LEDの仕様に応じて、抵抗値は変更してください。
  * 未検証ですが、もしかすると、1608サイズの方がよいかもしれません。
* 1x [NJM12888-33](https://akizukidenshi.com/catalog/g/gI-10675)
  * イネーブルピン付き 3.3V 電圧レギュレーター
* 2x [2012サイズ 0.1uF 表面実装コンデンサ](https://akizukidenshi.com/catalog/g/gP-00349)
* 1x [2012サイズ 1uF 表面実装コンデンサ](https://akizukidenshi.com/catalog/g/gP-09174)
* 1x [スライドスイッチ 6011S1M1](https://akizukidenshi.com/catalog/g/gP-15365)
  * バックライトを点灯/消灯するためのスイッチです。
  * 2.54mm間隔の3本足のスイッチであれば、[他のスイッチ](https://akizukidenshi.com/catalog/c/cslidesw/)でも良いです。

# キーキャップについて

16mmピッチのため、標準のキーキャップは使用できません。
3Dプリントにより、キーキャップを製造する必要があります。

PG1232用に作成した、3Dプリントサービスへ発注するための STL ファイルを下記に配置しています。
* [cap/caps1514-all.stl](cap/caps1514-all.stl)
  * 幅14.5mm、奥行き13.5mm、トップの厚み 1.4mm となっています。
  * 切り抜きによる刻印があります。英語配列仕様です。
  * バックライト用に、字をくり抜いてみました。
  * 私が実際に発注に使用したデータです。
    * 素材は MJF の グラファイト磨き にしました。
    * A や D の中の部分などは、取れている場合がありました。
  * 製造費用を減らすため、サポートによりキャップを連結しています。カッター等を使用して、切り離す必要があります。
* [cap/caps1514-all-plain.stl](cap/caps1514-all-plain.stl)
  * cap/caps1514-all.stl の刻印なしバージョンです。

※3Dプリントサービスによっては、 メール にて破損の可能性を指摘されます。
その場合、破損しても問題ない旨をメールにて返信することで、製造してもらえます。

# ファームウェアについて

私が所持している SAMD21 版 XIAO に、 QMK が対応していないため、
Arduinoベースの独自ファームウェアになっています。

ソースコードのみ、 [prog](prog) にて公開していますので、自身でコンパイルの上、書き込みを行ってください。

SAMD21 版 XIAO にのみ対応しており、RP2040版の XIAO 等には未対応です。

コンパイル・書き込み方法については [prog/README.ja.md](prog/README.ja.md) を参照ください。

# 選択項目

USBケーブルを出す方向、マウスボタンの位置が選択可能になっています。

## USBケーブルを出す方向

a. ケーブルを左から出す場合、XIAO を `U1_1` に取り付けます。

b. ケーブルを右から出す場合、XIAO を `U1_2` に取り付けます。

※ 2つのXIAO を `U1_1` と `U1_2` の両方に同時に取り付けることはできません。

## マウスボタンの位置

a. 2つともアナログスティックの左に置く  
  ![マウスボタン:左](resources/xiao-75-keyboard-btn-a.png)  
  左クリックも右クリックも左手で押す感じになります。

b. アナログスティックの左右に分けて置く  
  ![マウスボタン:左右](resources/xiao-75-keyboard-btn-b.png)  
  左クリックは左手、右クリックは右手で押す感じになります。

c. 2つともアナログスティックの右に置く  
  ![マウスボタン:右](resources/xiao-75-keyboard-btn-c.png)  
  左クリックも右クリックも右手で押す感じになります。  

# 組み立てに必要な道具

組み立てには以下の道具が必要です。
* ハンダごて一式
* 糸ハンダ
* はさみ
* ニッパー
* ピンセット
* テスター
* パソコン
* Type-C のUSBケーブル(パソコンとXIAOを接続するためのケーブル)

## あると便利な道具
* マイクロスコープ
* マスキングテープ
* 逆作用ピンセット
* ラジオペンチ
* ペースト状ハンダ

# 組み立て手順

この手順では、基板を、この画像の向きであるとして説明します。
[![基板のイメージ](resources/xiao-75-keyboard-3d-pcb-small.png)](resources/xiao-75-keyboard-3d-pcb.png)  

## 1. バックライト(オプション)

スイッチを取り付けた後は、バックライトLEDの取り付けができません。  
バックライトが不要な場合、[2. スイッチ用のダイオードと抵抗](<#2-スイッチ用のダイオードと抵抗>)へ進んでください。

### 1.1. バックライト用電源

基板右上隅の `U2`, `C1`, `C3`, `C2` にバックライト用電源部品をハンダ付けします。

![バックライト用電源部品](resources/bl-power.png)

1. `U2` に 電圧レギュレーターNJM12888-33 をハンダ付けします。端子が3つ出ている側が右側です。
2. `C1` に 0.1uF コンデンサ をハンダ付けします。向きはありません。
3. `C3` に 0.1uF コンデンサ をハンダ付けします。向きはありません。
4. `C2` に 1uF コンデンサ をハンダ付けします。向きはありません。

### 1.2. バックライト用LED

`LED11`〜`LED108`と`R11`〜`R108`に、LEDと抵抗をハンダ付けします。  
なお、 `LED20`,`LED30`,...,`LED100` および `R20`,`R30`,...,`R100` は欠番になっています。  
キースイッチの開口部とのクリアランスが小さいため、慎重に作業しましょう。  
LEDには極性があり、向きを間違えると正常に動作しませんので注意してください。  
マーク(カソード)が右側となるのが正しい向きになります。

1. 糸ハンダをはさみで0.5ミリほどに切断します。LED1つにつき2つ作ります。
2. 表面実装抵抗を、配置します。抵抗の左端が、真ん中のパッドの中心線に合う用に置きます。  
   ![バックライト用LED手順2の画像](resources/bl-led-2.png)
3. 切断した糸ハンダを、抵抗の右端に置きます。
4. 抵抗が動かないようピンセットで抵抗を押さえながら、ハンダごてを右からあてて、赤で示した箇所をハンダ付けします。  
   ![バックライト用LED手順4の画像](resources/bl-led-4.png)
5. LEDの右端が抵抗にぴったり合うように置きます。マーク(カソード)が右側に来るようにします。  
   ![バックライト用LED手順5の画像](resources/bl-led-5.png)
6. 切断した糸ハンダを、LEDの左側に置きます。
7. LEDが動かないようピンセットでLEDを押さえながら、ハンダごてを左からあてて、赤で示した箇所をハンダ付けします。  
   ![バックライト用LED手順7の画像](resources/bl-led-7.png)
8. キースイッチをはめてみて、干渉しないか確認します。
9. テスターでLEDの向きが正しいか確認します。まだ抵抗とは接続していないので、LEDの両端にテスターを当てます。  
   左がプラスで右がマイナスです。  
   ![バックライト用LED手順9の画像](resources/bl-led-9.png)
10. 赤で示した、LEDと抵抗の接続点をハンダ付けします。  
    ![バックライト用LED手順10の画像](resources/bl-led-10.png)

実装例:  
![バックライト用LEDの実装例](resources/led-sample.jpg)

2、3ペアやってみて、慣れてきたら、2〜4番(抵抗のハンダ付け)を全部、5〜7番(LEDのハンダ付け)を全部……、のようにやるといいと思います。

### 1.3. バックライト用スイッチ

基板右上隅の `SW1` に バックライト用スイッチ をハンダ付けします。  
バックライト用スイッチは、リード線をニッパーで切断してからハンダ付けします。

1. バックライト用スイッチを基板に差し込みます。
2. 裏面に突き出しているリード線を、基板ギリギリでニッパーで切断します。
3. 真ん中のリード線をハンダ付けします。
4. 表面を見て、バックライト用スイッチが基板から浮いていないか確認します。
5. 残りのリード線をハンダ付けします。

## 2. スイッチ用のダイオードと抵抗

アナログスティックやスイッチを正常動作させるためのダイオードと抵抗をハンダ付けします。

各ダイオードは、下記の要領で基板にハンダ付けします。  
ダイオードには極性があり、向きを間違えると正常に動作しませんので注意してください。  
縦線(カソード)が右側となるのが正しい向きになります。

1. 糸ハンダをはさみで0.5ミリほどに切断します。ダイオード1個につき2個作ります。
2. ダイオードを1つ置きます。縦線(カソード)が右側となります。
3. 切断した糸ハンダを、ダイオードの右の端子の右に置きます。
4. ダイオードが動かないよう、ピンセットでダイオードを押さえながら、ハンダごてを右からあてて、ハンダ付けします。
5. テスターでダイオードの向きが正しいか確認します。
6. 切断した糸ハンダを、ダイオードの左の端子の左に置きます。
7. ハンダごてを左からあてて、ハンダ付けします。

6〜7番は、基板の上下を入れ替えると、作業しやすいと思います。

抵抗をハンダ付けする場合も、同じ要領でハンダ付けします。  
抵抗には極性はありませんので、向きは気にしなくてよいです。
テスターによる向きの確認も不要です。

### 2.1. アナログスティック用ダイオード

基板中央下部の `D99`, `PD9`, `D109`, `PD10` に、表面実装ダイオード SS2040FL をハンダ付けします。  
全てのダイオードは、縦線(カソード)が右側となるのが正しい向きになります。

![アナログスティック用ダイオード](resources/analog-diode.png)

### 2.2. スイッチ用ダイオード

`D1`〜`D10`・`D99`・`D109`を*除く*、 `D11`〜`D108` に、表面実装ダイオード 1N4148W をハンダ付けします。  
なお、 `D20`,`D30`,...,`D100` は欠番になっています。  
`D96_1` と `D96_2`、`D98_1` と `D98_2` は、それぞれ選択制です。それぞれ、どちらか一方のみダイオードを取り付けます。([マウスボタンの位置](#マウスボタンの位置)を参照ください)  
全てのダイオードは、縦線(カソード)が右側となるのが正しい向きになります。

![キーボードスイッチ用ダイオード](resources/keyboard-diode.png)
![ボタンスイッチ用ダイオード](resources/button-diode.png)

一度全てのダイオードの右側のみハンダ付け(要領の4番まで)を行い、一気にテスターで向きを確認すると、効率的に作業できます。

### 2.3. 列用抵抗

基板下寄りに横に並んでいる、 `R1`〜`R10` に、 表面実装抵抗 560Ω 1608サイズ をハンダ付けします。  
抵抗に向きはありませんが、印字があるので、印字の向きを統一すると、なんとなく気分が良いです。

![列用抵抗の取り付け位置](resources/col-resistors.png)

縦に2組パッドが並んでいますが、抵抗は、`R` と書いてある側に取り付けてください。

### 2.4. 列用ダイオード

列用抵抗の下、 `D1`〜`D10` に、 表面実装ダイオード 1SS355VM をハンダ付けします。  
全てのダイオードは、縦線(カソード)が右側となるのが正しい向きになります。  
が、見えないので、テスターで向きを確認することをおすすめします。

![列用ダイオードの取り付け位置](resources/col-diodes.png)

間違ってダイオード用のパッドに抵抗を取り付けてしまっていた場合は、
ダイオードを抵抗用のパッドに *左右逆にして* 取り付けると、一応なんとかなります。

## 3. XIAO

### 3.1. 細ピンヘッダ

XIAOに、細ピンヘッダをハンダ付けします。  
裏向きで使うので、USBソケットや金属カバーがついている方へ足が出るよう、ハンダ付けします。

1. 細ピンヘッダを、XIAOに裏面から差し込みます。
2. 足の長さを、表に5mm出るように調整します。ラジオペンチで挟み込むと、調整しやすいです。
3. 表から、細ピンヘッダを1ピンだけ、ハンダ付けします。
4. ピンが垂直になるよう、調整します。
5. 残りのピンをハンダ付けします。
6. 黒いやつを取ります。基板にそって、薄くて固いヘラなどを差し込み、こじるように少しずつ持ち上げます。
7. XIAOの裏側で、足を切断します

### 3.2. 丸ピンICソケット

基板左下の `U1_1` と 基板右下の `U1_2` のどちらか、または両方に、丸ピンICソケットをハンダ付けします。

1. XIAOにハンダ付けした細ピンヘッダに、丸ピンICソケットをはめます。
2. 基板に表側から差し込みます。
3. この状態で、USBケーブルを XIAO に差し込めるか確認します。
4. ピンヘッダの足の、基板の裏に突き出ている部分をニッパーで切断します。
5. ハンダ付けします。

## 4. アナログスティック

基板中央下部の `TS1` に、 アナログスティック JT8P をハンダ付けします。

1. JT8P を基板の表から差し込みます。
2. JT8P の端子の、基板の裏に突き出ている部分をニッパーで切断します。
3. ハンダ付けします。

## 5. 動作確認

ハンダ付け不良等の確認のため、スイッチを取り付ける前に、一通り動作確認します。

1. キーボードに XIAO を取り付けます。
2. パソコン と XIAO を USBケーブルで接続します。
3. XIAO にファームウェアを書き込みます。
   * ファームウェアについては [prog/README.ja.md](prog/README.ja.md) を参照ください。
4. ピンセット等で、スイッチの端子を短絡させ、パソコンでキーが認識されるか確認します。
   * `SW93` と `SW105` は、標準のキーマップでは `Fn` キーのため、単独ではパソコンで認識されません。
     一時的にキーマップを変更するか、 `SW68` や `SW81` と組み合わせて確認します。
5. アナログスティックを動かし、パソコンでカーソルが同じ方向に移動するか確認します。
6. バックライト用スイッチを右に入れ、全てのLEDが点灯するか確認します。

## 6. キースイッチ

### 6.1. キーボード用スイッチ

`SW11`〜`SW108` に、キーボード用スイッチ Kailh PG1232 または Kailh PG1350 をハンダ付けします。  
なお、 `SW20`,`SW30`,...,`SW100` と `SW96`、 `SW98` は欠番になっています。

### 6.2. マウスボタン用スイッチ

`BTN1_1`, `BTN1_2`, `BTN2_1`, `BTN2_2` のうち、ダイオードを取り付けた所に、マウスボタン用スイッチ Kailh PG1425 をハンダ付けします。  
ダイオードを取り付けてない所にスイッチを取り付けても動作しません。例えば、 `D96_1` にダイオードを取り付けて `BTN1_2` にスイッチを取り付けても動作しません。

## 7. キャップ

キースイッチ、アナログスティックにキャップを取り付けます。

## ★☆完成☆★

耐震ジェルなどに載せて使うとよいと思います。  
手のひらが XIAO にあたると、誤作動するので、手首置きを使った方がよいです。
